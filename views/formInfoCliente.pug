extends partials/messages.pug
append head
  // Librerias Awesomplate
  link(rel='stylesheet', href='lib/lib_awesomplete/awesomplete.css')
  script(src='/socket.io/socket.io.js')
  link(href="lib/MDBootstrap 4.8.7/css/addons/datatables.min.css" rel="stylesheet")
append area-librerias-scripts
  // JavaScript de awesomplate 
  script(src='lib/lib_awesomplete/awesomplete.js')
  script(type="text/javascript" src="lib/MDBootstrap 4.8.7/js/addons/datatables.min.js")
append styles

  style.
    .modal-dialog.modal-notify.modal-danger .fas{
      color: #4f4f4f;
    }
    .modal-dialog.modal-notify.modal-danger .far{
      color: #4f4f4f;
    }
    .awesomplete {
      margin-left: 2.5rem;
    }

    .dtHistorialCliente {
      max-width: 600px;
      margin: 0 auto;
    }

    #dtHistorialCliente th, td {
      white-space: nowrap;
    }

    table.dataTable thead .sorting:after,
    table.dataTable thead .sorting:before,
    table.dataTable thead .sorting_asc:after,
    table.dataTable thead .sorting_asc:before,
    table.dataTable thead .sorting_asc_disabled:after,
    table.dataTable thead .sorting_asc_disabled:before,
    table.dataTable thead .sorting_desc:after,
    table.dataTable thead .sorting_desc:before,
    table.dataTable thead .sorting_desc_disabled:after,
    table.dataTable thead .sorting_desc_disabled:before {
      bottom: .5em;
    }

prepend area-scripts
  script.
    $(document).ready(() => {
      const sk_InfoCliente = io();
      const sk_nuevoCliente = io();

      let saveOrEdit = false;

      let updateUser = {
        nombreCliente : '',
      }

      // === === === AWESOMPLETE === === ===
      // Autocompletado ==> TIPO-CLIENTE
      // - variables 
      const data                     = !{JSON.stringify(data)} //Recuperar las marcas de autos de las rutas ¡¡
      let ClientCarr               = data.ClientCarr;
      const id_Tipo_cliente          = data.Tipos_Cliente.idTipo_cliente // indice y marca
      const Tipo_cliente             = data.Tipos_Cliente.Tipo_cliente
      const val_id_Vehiculo          = data.ClientCarr[0].id_vehiculo
      const id_persona               = data.InfoUser.id_usuario    
      const etiquetaInputTipoCliente = $('#tipo_cliente').get(0)
      let idCliente = null;
      const AWSPTipoCliente = new Awesomplete(etiquetaInputTipoCliente, { sort : false,maxItems: 5,filter: Awesomplete.FILTER_STARTSWITH});
      console.log('Tipo_cliente',Tipo_cliente)
      console.log('Tipo_cliente',Tipo_cliente)
      AWSPTipoCliente.list = Tipo_cliente;
      $('#tipo_cliente').on('awesomplete-selectcomplete',function() {
        let i = Tipo_cliente.indexOf(this.value);
        console.log("id de Tipo_cliente",id_Tipo_cliente[i]); //Ver id seleccionado de marca
        //$('#tipo_cliente_send').val(id_Tipo_cliente[i]);
      });

      const nombre_dni      = data.nombre_dni;
      const pIdCliente      = data.pId_cliente;
      const pNombreCliente      = data.pnombre_cliente;
      // indice y marca recuperada            
      etiquetaInputBusqueda = $('#idBusqueda').get(0);
      //AWSPBusqueda = new Awesomplete(etiquetaInputBusqueda, { maxItems: 5,filter: Awesomplete.FILTER_STARTSWITH});
      AWSPBusqueda = new Awesomplete(etiquetaInputBusqueda, { maxItems: 5});
      AWSPBusqueda.list = nombre_dni;
      console.log('lista de nombres y dni',nombre_dni);

      // - accion click obcion
        console.log(pIdCliente);
        $('#idBusqueda').on('awesomplete-selectcomplete',function () {
          //El método indexOf () devuelve la posición de la primera aparición de un valor especificado en una cadena.
          let i = pNombreCliente.indexOf(this.value); 
          console.log(this.value,'id es',pIdCliente[i])
          sk_nuevoCliente.emit('data_cliente',pIdCliente[i])
          $('#idBusqueda').val('')
          $('#idBusqueda').blur()
          
          $('#busqueda_id_cliente').val(pIdCliente[i])
          // Aca me quede Crear socket para recuperar datos de cliente enc campo
        });

      // === === ESTILOS === ===
        $('#dtHistorialCliente').DataTable({
          "scrollX": true,
          "lengthChange": false, // Mostrar numero de entradas
          "order": [[ 0, "desc" ]],
          "columns": [
              null,
              null,
              null,
              {
                "render": function(data, type, row){
                return data.split("+").join("<br/>");
                }
              },
              null,
              null,
              null,
              {
                "render": function(data, type, row){
                return data.split("+").join("<br/>");
                }
              }
          ]
        });


        $('#dtHistorialLlamadas').DataTable({
            "scrollX": true
        });

        $('.dataTables_length').addClass('bs-select');

        // Agrega o remueve clases de estilo y cambia de color al label
          Estilo_input_AWSP = (pIdLabel='',pIdico='',pColor ='',pEstado='') => {
            if(pEstado == 'add'){
              $(pIdLabel).addClass("active");
              $(pIdico).addClass("active");
              $(pIdLabel).css({"color": pColor});
            }else if(pEstado != ''){
              $(pIdLabel).removeClass("active");
              $(pIdico).removeClass("active");
              $(pIdLabel).css({"color": pColor});
            }else{
              $(pIdLabel).css({"color": pColor});
            }
          }

        // Agregar o quitar estilo agregado
          Estilo_Estado = (pIdInput='',pIdLabel='',pEstado='sicss') =>{
            if(pEstado == 'sicss'){
              $(pIdInput).css({ "border-bottom":"1px solid #D2202E",
                "box-shadow":"0 1px 0 0 #D2202E"});
            }else{
              console.log('removiendo estilos')
              $(pIdInput).removeAttr("style")
              $(pIdLabel).removeAttr("style")
            }
          }
        //Establece un estilo a Combo_tipo_Awesomplete al hacer focus y deshacer focus
          Awesome_Combo_Bootstrap = (id_input,lb_input,ico_input='',idButton ='') => {
            $(id_input).focus(() =>  {
              Estilo_input_AWSP(lb_input,ico_input,'#D2202E','add');     
            });
            $(id_input).focusout(() => {
              if ($(id_input).val() == "" ||  $ (id_input).val () == null ){
                Estilo_input_AWSP(lb_input,ico_input,'#4f4f4f','remove'); 
              }else{
                Estilo_input_AWSP(lb_input,'','#4f4f4f','');
              }   
            })    
          }

        // Ejecutar Awesome_Combo_Bootstrap para dar formato de estilo personalizado
          Awesome_Combo_Bootstrap(tipo_cliente,lb_tipo_cliente,ico_tipo_cliente);

      // === FUNCIONES === ===
        Busqueda_en_Array = (valor, array) => {
          return (array.indexOf(valor) > -1);
        }

        Crear_Nombre_Orden = (Data, pIdVehiculo, i) => {
          $('#PanelClientes').append(
            `<form action="abrir-orden" method="POST">
            <div class="row mt-3">
              <div class="col-sm-12">
                <div class="card">
                  <h4 class="card-header py-2 border-bottom-0"> 
                    <div class="row d-flex justify-content-between align-items-center ml-1 text-uppercase">
                    <small>${Data.nombre_cliente}</small>
                    <a class="btn btn-success btn-sm rounded-pill" type="button" href="tel:${Data.telefono}">
                      <i class="fas fa-phone"></i>
                    </a>
                    </div>
                    <div class="row d-flex justify-content-start ml-1 text-capitalize">
                      <cite class="blockquote-footer text-success" title="Source Title">${Data.tipo_cliente}</cite>
                    </div>
                  </h4>
                  <div class="card-body">
                    <div class="row">
                      <div class="form-group col-md-4">
                        <div class="row">
                          <div class="col-6">
                            <label>DNI: </label>
                          </div>
                          <div class="col-6">
                            <p class="card-text" onclick="CopiarDNI(this)">${Data.dni}</p>
                          </div>
                        </div>
                      </div>
                      <div class="form-group col-md-4">
                        <div class="row">
                          <div class="col-6">
                            <label>E-mail: </label>
                          </div>
                          <div class="col-6">
                            <p class="card-text">${Data.email}</p>
                          </div>
                        </div>
                      </div>
                      <div class="form-group col-md-4">
                        <div class="row">
                          <div class="col-6">
                            <label>Telefono: </label>
                          </div>
                          <div class="col-6">
                            <p class="card-text">${Data.telefono}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group col-md-4">
                        <div class="row">
                          <div class="col-6">
                            <label>ruc: </label>
                          </div>
                          <div class="col-6">
                            <p class="card-text">${Data.ruc}</p>
                          </div>
                        </div>
                      </div>
                      <div class="form-group col-md-4">
                        <div class="row">
                          <div class="col-6">
                            <label>Razón Social: </label>
                          </div>
                          <div class="col-6">
                            <p class="card-text">${Data.razon_social}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group col-md-4">
                        <div class="row">
                          <div class="col-5">
                            <label>direccion: </label>
                          </div>
                          <div class="col-7">
                            <p class="card-text">${Data.direccion}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="d-flex justify-content-end">
                      <div class="btn btn-primary btn-sm rounded" onclick="BotonActualizar(${i})" type="button" data-toggle="modal" data-target="#modalEditUser">
                      <i class="far fa-edit fa-2x"></i></div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="row">
                      <div class="col-12">
                        <input type="hidden" name="id_usuario" value="${Data.id_cliente}"/>
                        <input type="hidden" name="id_vehiculo" value="${pIdVehiculo}"/>
                        <input type="hidden" name="id_tipo_cliente" value="${Data.id_tipo_cliente}"/>
                        <button class="btn btn-success btn-block rounded-pill" type="submit">Crear Pedido</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>`
          )
        }
        Crear_Nombre_Orden2 = (Data) => {
          $('#agregado').prepend('<form action="abrir-orden" method="POST">\
            <div class="row mt-3">\
              <div class="col-sm-12">\
                <div class="card">\
                  <h4 class="card-header d-flex justify-content-between">\
                    <div class="row justify-content-center align-items-center ml-1 text-capitalize">\
                    <small>'+Data.DataUser.nombre_cliente+' '+Data.DataUser.tipo_cliente+'</small></div>\
                    <button class="btn btn-success btn-sm" type="button">\
                      <i class = "fas fa-phone"></i>\
                    </button>\
                  </h4>\
                  <div class="card-body">\
                    <div class="row">\
                      <div class="form-group col-md-5">\
                        <div class="row">\
                          <div class="col-6"><label>DNI:</label></div>\
                          <div class="col-6">\
                            <p class="card-text">'+Data.DataUser.dni+'</p>\
                          </div>\
                        </div>\
                      </div>\
                      <div class="form-group col-md-5">\
                        <div class="row">\
                          <div class="col-6"><label>E-mail:</label></div>\
                          <div class="col-6">\
                            <p class="card-text">'+Data.DataUser.email+'</p>\
                          </div>\
                        </div>\
                      </div>\
                    </div>\
                    <div class="row">\
                      <div class="form-group col-md-5">\
                        <div class="row">\
                          <div class="col-6"><label>ruc:</label></div>\
                          <div class="col-6">\
                            <p class="card-text">'+Data.DataUser.ruc+'</p>\
                          </div>\
                        </div>\
                      </div>\
                      <div class="form-group col-md-5">\
                        <div class="row">\
                          <div class="col-5"><label>direccion:</label></div>\
                          <div class="col-7">\
                            <p class="card-text">'+Data.DataUser.direccion+'</p>\
                          </div>\
                        </div>\
                      </div>\
                    </div>\
                  </div>\
                  <div class="card-footer">\
                    <div class="row">\
                      <div class="col-6"><input name="id_usuario" type="hidden" value='+Data.DataUser.id_cliente+'>\
                      <input name="id_vehiculo" type="hidden" value='+Data.val_id_Vehiculo+'>\
                      <input name="id_tipo_cliente" type="hidden" value='+Data.DataUser.id_tipo_cliente+'>\
                      <button class="btn btn-success btn-block rounded-pill" type="submit">Crear Pedido</button></div>\
                    </div>\
                  </div>\
                </div>\
              </div>\
            </div>\
          </form>'); 
      }
        Limpiar_Modal_Form = (Estado) => {
          $('#tipo_cliente').val('')
          $('#lb_tipo_cliente').removeClass("active")
          $('#nombreCliente').val('')
          $('#lbnombre').removeClass("active")
          $('#telefono').val('')
          $('#lbtelefono').removeClass("active")
          $('#email').val('')
          $('#lbemail').removeClass("active")
          $('#dni').val('')
          $('#lbdni').removeClass("active")
          $('#ruc').val('')
          $('#lbRuc').removeClass("active")
          $('#razon_social').val('')
          $('#lbrazon_social').removeClass("active")
          $('#direccion').val('')
          $('#lbDireccion').removeClass("active")

          $('#modalEditUser').modal(Estado)
        }

        Validacion_Campos = (array) => {
          // ingresar los valores de los inputs en un array
          // La funcion retornara un true si esta correcto o false si falta algun input rellenar
          let contador = 0;
          for(let i = 0 ;i <= array.length-1;i++){
            var length = $.trim(array[i]).length;
            if(length != 0){
              contador++;
            }
          }
          if(contador != array.length){return false}else{return true}
          }
        
        CopiarDNI = (element) => {
          //creamos un input que nos ayudara a guardar el texto temporalmente
          var $temp = $("<input>");
          //lo agregamos a nuestro body
          $("body").append($temp);
          //agregamos en el atributo value del input el contenido html encontrado
          //en el td que se dio click
          //y seleccionamos el input temporal
          $temp.val($(element).html()).select();
          //ejecutamos la funcion de copiado
          document.execCommand("copy");
          //eliminamos el input temporal
          $temp.remove();
        }

      // === EVENTOS === ===
      //BOTON TIPO CLIENTE ( BLUR )    
        $("#btn_tipo_cliente").blur(() => {
          if($("#tipo_cliente").val() == "" ||  $ ("#tipo_cliente").val() == null ){
            console.log('blur cerrado por desenfoque y nulo')
            AWSPTipoCliente.close();
            Estilo_Estado(tipo_cliente,lb_tipo_cliente,'nocss');
            Estilo_input_AWSP(lb_tipo_cliente,ico_tipo_cliente,'#4f4f4f','remove');
          }else{
            AWSPTipoCliente.close();
            console.log('blur cerrado por desenfoque')
            $(tipo_cliente).removeAttr("style")
            Estilo_input_AWSP(lb_tipo_cliente,'','#4f4f4f','');
          }
        });

      //BOTON TIPO_CLIENTE ( CLICK )
        $('#btn_tipo_cliente').click(() => {
          Estilo_input_AWSP(lb_tipo_cliente,ico_tipo_cliente,'#D2202E','add');
          if (AWSPTipoCliente.ul.childNodes.length === 0) {
            AWSPTipoCliente.minChars = 0;
            AWSPTipoCliente.evaluate();
            Estilo_Estado(tipo_cliente,'','sicss');
            console.log('btn abriendo por evaluate')       
          }else if (AWSPTipoCliente.ul.hasAttribute('hidden')) {
            Estilo_Estado(tipo_cliente,'','sicss');
            console.log('btn abriendo por click')
            AWSPTipoCliente.open();
          }else if($("#tipo_cliente").val() == "" ||  $ ("#tipo_cliente").val() == null ){
            AWSPTipoCliente.close();
            console.log('btn cerrado por texto vacio')
            Estilo_Estado(tipo_cliente,lb_tipo_cliente,'nocss');
            Estilo_input_AWSP(lb_tipo_cliente,ico_tipo_cliente,'#4f4f4f','remove');
            }else{
              AWSPTipoCliente.close();
              console.log('btn cerrando')
              Estilo_Estado(tipo_cliente,'','nocss');
              Estilo_input_AWSP(lb_tipo_cliente,'','#4f4f4f','');
            }
        });
      // BOTON NUEVO USUARIO
        $('#btnNuevoUsuario').click(() => {
          Limpiar_Modal_Form('show');
          saveOrEdit = true;
          idCliente = null;
          const titleModal = `CREAR USUARIO PARA EL VEHICULO`;
          const titleMarcaModeloModal = `(${ClientCarr[0].vehiculo_marca} - ${ClientCarr[0].modelo})`;
          const titleButtonCreate = 'GUARDAR';
          $('#titleModal').text(titleModal);
          
          // ESTILOS BTN CREAR
          $('#btnCrear').text(titleButtonCreate);
          $('#btnCrear').removeClass("btn-primary");
          $('#btnCrear').addClass("btn-danger");

          // ESTILOS BTN LIMPIAR
          $('#btnLimpiar').removeClass("btn-outline-primary");
          $('#btnLimpiar').addClass("btn-outline-danger");

          // ESTILOS BTN CANCELAR
          $('#btnCancelar').removeClass("btn-outline-primary");
          $('#btnCancelar').addClass("btn-outline-danger");

          $('#titleMarcaModeloModal').text(titleMarcaModeloModal);
          $('#barModal').removeClass("modal-primary");
          $('#barModal').addClass("modal-danger");
          $('#icoModal').removeClass();
          $('#icoModal').addClass("fas fa-user-plus fa-2x text-white");

          console.log('Mi id cliente es', idCliente);
          console.log('ESTADO DE ACTUALIZACION', saveOrEdit);
        });
      
      // BOTON ACTUALIZAR USUARIO
      BotonEliminarCliente = (i) => {

      }

      // BOTON ACTUALIZAR USUARIO
      BotonActualizar = (i) => {
        Limpiar_Modal_Form('show');
        console.log('ClientCarr es', ClientCarr);
        saveOrEdit = false;
        idCliente = ClientCarr[i].id_cliente;
        console.log('Mi id cliente es', idCliente);
        console.log('ESTADO DE ACTUALIZACION', saveOrEdit);
        const titleModal = `ACTUALIZAR USUARIO DEL VEHICULO`;
        const titleMarcaModeloModal = `(${ClientCarr[0].vehiculo_marca} - ${ClientCarr[0].modelo})`;
        const titleButtonCreate = 'ACTUALIZAR';
        $('#titleModal').text(titleModal);
        
        // ESTILOS BTN
        $('#btnCrear').text(titleButtonCreate);
        $('#btnCrear').removeClass("btn-danger");
        $('#btnCrear').addClass("btn-primary");

        // ESTILOS BTN LIMPIAR
        $('#btnLimpiar').removeClass("btn-outline-danger");
        $('#btnLimpiar').addClass("btn-outline-primary");

        // ESTILOS BTN CANCELAR
        $('#btnCancelar').removeClass("btn-outline-danger");
        $('#btnCancelar').addClass("btn-outline-primary");

        $('#titleMarcaModeloModal').text(titleMarcaModeloModal);
        $('#barModal').removeClass("modal-danger");
        $('#barModal').addClass("modal-primary");
        $('#icoModal').removeClass();
        $('#icoModal').addClass("fas fa-edit fa-2x text-white");
        
        $('#lb_tipo_cliente').addClass("active");
        $('#tipo_cliente').val(ClientCarr[i].tipo_cliente);

        $('#lbdni').addClass("active");
        $('#dni').val(ClientCarr[i].dni);

        $('#lbnombre').addClass("active");
        $('#nombreCliente').val(ClientCarr[i].nombre_cliente);

        if (ClientCarr[i].telefono != '') {
          $('#lbtelefono').addClass("active");
          $('#telefono').val(ClientCarr[i].telefono);
        }
        
        if (ClientCarr[i].email != '') {
          $('#lbemail').addClass("active");
          $('#email').val(ClientCarr[i].email);
        }
        
        if (ClientCarr[i].ruc != '') {
          $('#lbRuc').addClass("active");
          $('#ruc').val(ClientCarr[i].ruc);
        }
        
        if (ClientCarr[i].razon_social != '' && ClientCarr[i].razon_social != null) {
          $('#lbrazon_social').addClass("active");
          $('#razon_social').val(ClientCarr[i].razon_social);
        }
        
        if (ClientCarr[i].direccion != '') {
          $('#lbDireccion').addClass("active");
          $('#direccion').val(ClientCarr[i].direccion);
        }
      }
      $('.actualizar').click(() => {
        // RECUPERAR LOS DATOS DEL CLIENTE

        //$('#nombreCliente').val('JOSE');
        //$('#telefono').val(123);
        //$('#email').val('JGCUELAP');
        //$('#dni').val(123456);
        //$('#razon_social').val('ZICIAL');
        //$('#direccion').val('AV PERU');
        console.log('Valor de dni', $('#dniText').val());
        saveOrEdit = false;
        console.log('ESTADO DE ACTUALIZACION', saveOrEdit);
      });
      // BOTON REGISTRAR
      $('#btnCrear').click(() => {
        const nombre_cliente   = $('#nombreCliente').val();
        const telefono         = $('#telefono').val();
        const email            = $('#email').val();
        const dni              = parseInt($('#dni').val(), 10);
        const razonSocial      = $('#razon_social').val();
        const direccion        = $('#direccion').val();
        const val_tipo_cliente = $('#tipo_cliente').val();
        const numeroRuc        = parseInt($('#ruc').val(), 10);
        const ruc              = (isNaN(numeroRuc) ? 0 : numeroRuc);
        const Campos           = [val_tipo_cliente, nombre_cliente];

        if(Validacion_Campos(Campos)) {
          const existenciaDeTipoCliente = Busqueda_en_Array(val_tipo_cliente, Tipo_cliente);
          let val_arr = [];
            //Puede enviar los datos nuevos del cliente 
            // con val tipo existente e Inexistentes
          if(!existenciaDeTipoCliente) { // si agregamos nuevo tipo cliente
            val_arr = [val_tipo_cliente, 1]; // si agregamos 1
            $('#tipo_cliente_send').val(val_arr); // sale un valor diferente

          } else { // no agregamos
            // envia el indice del tipo persona
            let i = Tipo_cliente.indexOf(val_tipo_cliente);
            console.log('seleccionado:',id_Tipo_cliente[i],'valor:',val_tipo_cliente)
            val_arr = [id_Tipo_cliente[i], 0]; // no agregamos 0
            $('#tipo_cliente_send').val(val_arr);
          }
          const NewUser = {
          val_id_Vehiculo,
          idCliente,
          nombre_cliente,
          telefono,
          email,
          dni,
          ruc,
          razonSocial,
          direccion,
          val_arr,
          id_persona,
          saveOrEdit
          }
          sk_InfoCliente.emit('Registrar_Ususario', NewUser);
          console.log('NewUser Envio', NewUser);
          console.log('ESTADO ', saveOrEdit);

          Limpiar_Modal_Form('toggle');
        } else {
          alert('Hay Uno o mas campos vacios')
        }
      });
      // BOTON LIMPIAR
      $('#btnLimpiar').click(() => {
        Limpiar_Modal_Form('show');
      });
      //BOTON BUSCAR_DNI (CLICK)
        $('#btn_dni').click(() => {
          const dni = $('#dni').val();
          const validarCeroVacio = [(dni == 0 ? "" : dni)];

          if (Validacion_Campos(validarCeroVacio)) {
            $('#nombreCliente').val('Cargando espere...');
            $('#lbnombre').addClass("active");
            $('#iconombre').removeClass("active");
            sk_nuevoCliente.emit('solicitar_info_dni', validarCeroVacio);
          } else {
            alert('El dni no puede estar VACIO');
          }
        });
      //BOTON BUSCAR_RUC (CLICK)
        $('#btn_ruc').click(() => {
          const ruc = $('#ruc').val();
          $('#razon_social').val('Cargando espere...');
          $('#lbrazon_social').addClass("active");
          $('#icorazon_social').removeClass("active");

          $('#direccion').val('Cargando espere...');
          $('#lbDireccion').addClass("active");
          $('#icoDireccion').removeClass("active");

          sk_nuevoCliente.emit('solicitar_info_ruc', ruc)
        });
      // BOTON ACTUALIZAR
        $('#btnActualizar').click(() => {
          alert('actualizó')
        })
      // === SOCKETS === ===
      sk_InfoCliente.on('Nuevo_Cliente', (data) =>{
        try{
          const DataUser = {
            id_cliente,
            id_tipo_cliente,
            tipo_cliente,
            nombre_cliente,
            telefono,
            email,
            dni,
            ruc,
            razonSocial,
            direccion
          } = data[0];
          // const NewUser = {data, val_id_Vehiculo}
          console.log('NewUser Recivido', data)
          ClientCarr = data;
          $('#PanelClientes').children('form').remove();
          for (let index = 0; index < data.length; index++) {
            Crear_Nombre_Orden(data[index], val_id_Vehiculo, index);
          }
          // Crear_Nombre_Orden(NewUser);
        }catch(error){
          console.log(error)
        }
      });
      // Recibir apis de dni e Rucf
      sk_nuevoCliente.on('recuperar_info_dni_online', (data) => {
          console.log('Salida dni', data);
          if(data != 'DESCONECCION'){
              if(data != 'An error has occurred.'){
                  $('#lbnombre').addClass("active");
                  $('#iconombre').addClass("active");
                  $('#nombreCliente').val(data);
                        // caso todo bien
              }else{
                  $('#nombreCliente').val('');
                  $('#lbnombre').removeClass("active");
                  $('#iconombre').removeClass("active");
                  alert("DNI Incorrecto")                        // caso que no encuentre el DNI
              }  
          }else{
              $('#lbnombre').removeClass("active");
              $('#iconombre').removeClass("active");
              $('#nombreCliente').val('');
              alert('No hay coneccion a internet')    // caso Sin internet :'(
          }
      });
      // Recibir apis de dni e Ruc
      sk_nuevoCliente.on('recuperar_info_dni_db', (data) => {
        console.log("busqueda por dni",data);
        $('#busqueda_id_cliente').val(data.id_cliente)
        sk_nuevoCliente.emit('data_cliente',data.id_cliente)
      });
      sk_nuevoCliente.on('recuperar_info_ruc',(data) => {
        if(data != 'DESCONECCION RUC'){
          $('#lbrazon_social').addClass("active");
          $('#icorazon_social').addClass("active");
          $('#razon_social').val(data.razon_social);     // caso todo bien

          $('#lbDireccion').addClass("active");
          $('#icoDireccion').addClass("active");
          $('#direccion').val(data.domicilio_fiscal);     // caso todo bien
        }else{
          $('#lbrazon_social').removeClass("active");
          $('#icorazon_social').removeClass("active");
          $('#razon_social').val('');     

          $('#lbDireccion').removeClass("active");
          $('#icoDireccion').removeClass("active");
          $('#direccion').val('');     
          alert('No hay coneccion a internet o ruc invalido')    // caso Sin internet :'(
        }
      });
      sk_nuevoCliente.on('data_info_cliente', data =>{
        //$('#tipo_cliente').val(data.tipo_cliente);
        //$('#lb_tipo_cliente').addClass("active");
        //$('#ico_tipo_cliente').addClass("active");
        //$('#tipo_cliente').attr('readonly','readonly');
        //$('#btn_tipo_cliente').prop('disabled',true),

        $('#nombreCliente').val(data.nombre_cliente);
        $('#lbnombre').addClass("active");
        $('#iconombre').addClass("active");
        $('#nombreCliente').attr('readonly','readonly');

        $('#telefono').val(data.telefono);
        $('#lbtelefono').addClass("active");
        $('#icotelefono').addClass("active");
        $('#telefono').attr('readonly','readonly');

        $('#email').val(data.email);
        $('#lbemail').addClass("active");
        $('#icoemail').addClass("active");
        $('#email').attr('readonly','readonly');

        $('#dni').val(data.dni);
        $('#lbdni').addClass("active");
        $('#icodni').addClass("active");
        $('#dni').attr('readonly','readonly');
        $('#btn_dni').prop('disabled',true);
        
        $('#ruc').val(data.ruc);
        $('#lbRuc').addClass("active");
        $('#icoRuc').addClass("active");
        $('#ruc').attr('readonly','readonly');
        $('#btn_ruc').prop('disabled',true);

        $('#razon_social').val(data.razon_social);
        $('#lbrazon_social').addClass("active");
        $('#icorazon_social').addClass("active");
        $('#razon_social').attr('readonly','readonly');

        $('#direccion').val(data.direccion);
        $('#lbDireccion').addClass("active");
        $('#icoDireccion').addClass("active");
        $('#direccion').attr('readonly','readonly');
      });
    });
append message
block contenido
  .container-fluid.px-0
    .card.rounded-0
      //-.card-header.text-center.alert-danger.value Datos de la placa
      .card-body
        .row.justify-content-center.align-items-center
          section.form-gradient
            .md-form
              i.fa.fa-car.prefix.mb-1
              input.form-control-xl.text-center.text-uppercase.h4.orden(name='placa',value = data.ClientCarr[0].placa , type='text', autocomplete='off' readonly="readonly")
        h5.card-title Datos de Usuario
        // Button trigger modal
        if data.InfoUser.id_tipo_usuario == 2
          .d-flex.justify-content-center
            #btnNuevoUsuario.btn.btn-success.rounded-pill(type="button" data-toggle="modal" data-target="#modalEditUser")
              i.fas.fa-plus-circle.pr-1
              | Agregar nuevo Usuario
        // Modal: modalEditUser
        include mixins/FormAgregarEditarCliente
        include mixins/FormDeleteCliente
        //- NAVEGADOR
        ul.nav.nav-tabs(role='tablist')
          li.nav-item
            a#client-tab.nav-link.active(data-toggle='tab', href='#client', role='tab', aria-controls='client', aria-selected='true') Usuarios
          li.nav-item
            a#car-tab.nav-link(data-toggle='tab', href='#car', role='tab', aria-controls='car', aria-selected='false') Automovil
          //-li.nav-item
          //-  a#history-tab.nav-link(data-toggle='tab', href='#history', role='tab', aria-controls='history', aria-selected='false') Historial
        .tab-content
          //- iNFO DEL CLIENTE
          #client.tab-pane.fade.show.active(role='tabpanel', aria-labelledby='client-tab')
            #agregado.agregado
            #PanelClientes
              - for (let i = 0; i < data.nResultados; ++i) {
                form(action='abrir-orden' method='POST')
                  .row.mt-3
                    .col-sm-12
                      .card
                        h4.card-header.py-2.border-bottom-0 
                          .row.d-flex.justify-content-between.align-items-center.ml-1.text-uppercase
                            small #{data.ClientCarr[i].nombre_cliente}
                            a.btn.btn-success.btn-sm.rounded-pill(type='button' href='tel:'+data.ClientCarr[i].telefono+'')
                              i.fas.fa-phone
                          .row.d-flex.justify-content-start.ml-1.text-capitalize
                            cite.blockquote-footer.text-success(title="Source Title") #{data.ClientCarr[i].tipo_cliente}
                        .card-body
                          .row
                            .form-group.col-md-4
                              .row
                                .col-6
                                  label DNI: 
                                .col-6
                                  p.card-text(onclick="CopiarDNI(this)") #{data.ClientCarr[i].dni}
                            .form-group.col-md-4
                              .row
                                .col-6
                                  label E-mail: 
                                .col-6
                                  p.card-text #{data.ClientCarr[i].email}
                            .form-group.col-md-4
                              .row
                                .col-6
                                  label Telefono: 
                                .col-6
                                  p.card-text #{data.ClientCarr[i].telefono}
                          .row
                            .form-group.col-md-4
                              .row
                                .col-6
                                  label ruc: 
                                .col-6
                                  p.card-text #{data.ClientCarr[i].ruc}
                            .form-group.col-md-4
                              .row
                                .col-6
                                  label Razón Social: 
                                .col-6
                                  p.card-text #{data.ClientCarr[i].razon_social}
                          .row
                            .form-group.col-md-4
                              .row
                                .col-5
                                  label direccion: 
                                .col-7
                                  p.card-text #{data.ClientCarr[i].direccion}
                          .d-flex.justify-content-end
                            // .btn.btn-danger.btn-sm.rounded(onclick= 'BotonEliminarCliente('+i+')' type="button" data-toggle="modal" data-target="#modalConfirm")
                            //   | Eliminar
                            .btn.btn-primary.btn-sm.rounded(onclick= 'BotonActualizar('+i+')' type="button" data-toggle="modal" data-target="#modalEditUser")
                              i.far.fa-edit.fa-2x
                        .card-footer
                          .row
                            .col-12
                              input(type="hidden" name='id_usuario' value= data.ClientCarr[i].id_cliente)
                              input(type="hidden" name='id_vehiculo' value= data.ClientCarr[i].id_vehiculo)
                              input(type="hidden" name='id_tipo_cliente' value= data.ClientCarr[i].id_tipo_cliente) 
                              if data.InfoUser.id_tipo_usuario == 2
                                button.btn.btn-success.btn-block.rounded-pill(type='submit') Crear Pedido
              - }

          //- iNFO DEL AUTOMOVIL
          #car.tab-pane.fade(role='tabpanel', aria-labelledby='car-tab')
            .row.mt-3
              .col-sm-12
                .card
                  h4.card-header.d-flex.justify-content-between
                    .row.justify-content-center.align-items-center.ml-1.text-capitalize
                      small #{data.ClientCarr[0].vehiculo_marca}
                  .card-body
                    .row
                      .form-group.col-md-5
                        .row
                          .col-6
                            label Modelo: 
                          .col-6
                            p.card-text #{data.ClientCarr[0].modelo}
                      .form-group.col-md-5
                        .row
                          .col-6
                            label Año: 
                          .col-6
                            p.card-text #{data.ClientCarr[0].anio}
                    .row
                      .form-group.col-md-5
                        .row
                          .col-6
                            label Color: 
                          .col-6
                            p.card-text #{data.ClientCarr[0].color}
                      //.form-group.col-md-5
                      //  .row
                      //    .col-6
                      //      label otros: 
                      //    .col-6
                      //      p.card-text #{data.ClientCarr[0].color}
                  .card-footer
                    .row
                      .col-12
                        // <button id="boton" type="button" class="btn btn-info text-nowrap">Nueva Orden</button>
                        if data.InfoUser.id_tipo_usuario == 2
                          button.btn.btn-success.btn-block.rounded-pill(type='submit') Crear Pedido

          //- iNFO DEL HISTORIAL
          
          //#history.tab-pane( aria-labelledby='history-tab')
          //    #accordion
          //      .card.mt-3
          //        .card-header
          //          a.card-link.row.collapsed(data-toggle='collapse', href='#description1')
          //            .col-10
          //              | Historial de #{data.ClientCarr[0].vehiculo_marca} #{data.ClientCarr[0].modelo} 
          //            .col-2
          //              i.fa.fa-chevron-down.pull-right
          //        .card-body
          //            | aca ira 
          //        .card-footer.text-center
          //            a.card-link(href='#') Mas detalles    
          //        #description1.collapse(data-parent='#accordion')
          //          .card-body
          //            | aca ira el reporte del historial
          //          .card-footer.text-center
          //            a.card-link(href='#') Mas detalles
                    .card-footer
                      .row
                        .col-6
                          button.btn.btn-danger(type='button') Editar
                        .col-6
                          <button id="boton" type="button" class="btn btn-info text-nowrap">Nueva Orden</button>
                          button.btn.btn-info(type='submit') Crear Pedido
          .card.rounded-0.mt-3 
            .card-header.py-2.border-bottom-0
                i#iconombre.fas.fa-clipboard-list.mr-2
                strong Historial de servicios
            .card-body.p-1
                .container-fluid
                if data.info_servicios.estado
                  table#dtHistorialCliente.table.table-striped.table-bordered.table-sm(cellspacing="0" width="100%")
                    thead
                      tr
                        th.th-sm Nro Orden
                        //th.th-sm Placa
                        //th.th-sm Marca
                        th.th-sm Km Inicial
                        th.th-sm Requerimiento (obs cliente)
                        th.th-sm Recomendacion
                        //th.th-sm Detalle de Cliente
                        th.th-sm Detalle de Recepcion
                        //th.th-sm Nombre Usuario
                        th.th-sm Antiguedad de Visita
                        th.th-sm Fecha de Visita
                        th.th-sm Detalle Requerimiento
                    tbody
                      - var i = 0;
                      each val in data.info_servicios.historial_servicios
                        tr
                          td
                            .d-flex.flex-column.bd-highlight
                              .bd-highlight.font-weight-bold #{data.info_servicios.historial_servicios[i].nro_orden}
                              if data.info_servicios.historial_servicios[i].id_estadoOrden == 7
                                .bd-highlight.text-primary.font-weight-bold #{data.info_servicios.historial_servicios[i].nombreEstadoOrden}...
                              else
                                .bd-highlight.text-danger.font-weight-bold #{data.info_servicios.historial_servicios[i].nombreEstadoOrden}
                          //-//td
                          //-  a.font-weight-bold.text-uppercase(href='/info-cliente?id_vehiculo='+data.historial_servicios[i].id_vehiculo+'&placa='+data.historial_servicios[i].placa+'') #{data.historial_servicios[i].placa}
                          //-  input(id='id_vehiculo_'+i type="hidden" value= 'data.historial_servicios[i].id_vehiculo') 
                          //-//td #{data.historial_servicios[i].vehiculo_marca}
                          td #{data.info_servicios.historial_servicios[i].km_inicial} km
                          td
                            // .bd-highlight.font-weight-bold #{data.info_servicios.historial_servicios[i].nombre_servicio[0]}
                            //.d-flex.justify-content-start
                            .d-flex.flex-column.bd-highlight
                              - var n = 0;
                              each valo in data.info_servicios.historialPedido[i].nombre_servicio
                                .bd-highlight.font-weight-bold #{data.info_servicios.historial_servicios[i].nombre_servicio[n]}
                                .bd-highlight.text-primary.font-weight-bold &nbsp - #{data.info_servicios.historial_servicios[i].descripcion_cliente[n]}
                                //strong.text-body #{data.info_servicios.historial_servicios[i].nombre_servicio}+strong.text-primary.ml-1 "#{data.info_servicios.historial_servicios[i].descripcion_cliente}"
                                //strong.text-primary.ml-1 "#{data.info_servicios.historial_servicios[i].descripcion_cliente}"
                                - n++
                          td
                            .d-flex.flex-column.bd-highlight
                              - var r = 0;
                              each valor in data.info_servicios.historial_servicios[i].nombreRecomendacion
                                .bd-highlight.font-weight-bold #{data.info_servicios.historial_servicios[i].nombreRecomendacion[r]}
                                .bd-highlight.text-success.font-weight-bold &nbsp - #{data.info_servicios.historial_servicios[i].descripcionRecomendacion[r]}
                                - r++
                          td #{data.info_servicios.historial_servicios[i].Detalle_usuario}
                          //td #{data.historial_servicios[i].nombre_cliente}
                          td #{data.info_servicios.Tiempo_Inicio[i]}
                          td #{data.info_servicios.Tiempo_Inicio_corto[i].fecha} #{data.info_servicios.Tiempo_Inicio_corto[i].hora}
                          td
                            if data.info_servicios.historial_servicios[i].Detalle_requerimiento == null
                              .text-danger Hace falta los requerimientos
                            else
                              .div #{data.info_servicios.historial_servicios[i].Detalle_requerimiento}
                        - i++
                    tfoot
                      tr
                        th Nro Orden
                        //th Placa
                        //th Marca
                        th Km Inicial
                        th Requerimiento (obs cliente)
                        th Recomendacion
                        //th Detalle de Cliente
                        th Detalle de Recepcion
                        //th Nombre Usuario
                        th Antiguedad de Visita
                        th Fecha de Visita
                        th Detalle Requerimiento
                else
                  p No existe Un historial de Servicios por el momento
          .card.rounded-0.mt-3 
            .card-header.py-2.border-bottom-0
                i#iconombre.fas.fa-clipboard-list.mr-2
                strong Historial de Seguimiento
            .card-body.p-1
                .container-fluid
                    if data.info_seguimiento.estado
                        table#dtHistorialLlamadas.table.table-striped.table-bordered.table-sm(cellspacing="0" width="100%")
                            thead
                                tr
                                    th.th-sm Nro Orden
                                    th.th-sm Usuario que llamó
                                    th.th-sm Etapa de Seguimiento
                                    th.th-sm Antiguedad de la llamada
                                    th.th-sm Fecha de la llamada
                                    th.th-sm Detalle Llamada
                            tbody
                                - var n = 0;
                                each val in data.info_seguimiento.historial_seguimiento
                                    tr
                                        td #{data.info_seguimiento.historial_seguimiento[n].nro_orden}
                                        td #{data.info_seguimiento.historial_seguimiento[n].nombre} #{data.info_seguimiento.historial_seguimiento[n].apellido_paterno} 
                                        td #{data.info_seguimiento.historial_seguimiento[n].nombre_etapa_seguimineto}
                                        td #{data.info_seguimiento.Tiempo_Seguimiento[n]}
                                        td #{data.info_seguimiento.Tiempo_Seguimiento_corto[n]}
                                        td #{data.info_seguimiento.historial_seguimiento[n].detalle_seguimiento}
                                    - n++
                            tfoot
                                tr
                                    th Nro Orden
                                    th Usuario que llamó
                                    th Etapa de Seguimiento
                                    th Antiguedad de la llamada
                                    th Fecha de la llamada
                                    th Detalle Llamada
                    else
                        p No existe Un historial por el momento
